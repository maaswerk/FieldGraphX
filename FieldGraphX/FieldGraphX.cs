using System;
using System.Collections.Generic;
using System.ComponentModel.Composition;
using System.IO;
using System.Linq;
using System.Reflection;
using XrmToolBox.Extensibility;
using XrmToolBox.Extensibility.Interfaces;

namespace FieldGraphX
{
    // Do not forget to update version number and author (company attribute) in AssemblyInfo.cs class
    // To generate Base64 string for Images below, you can use https://www.base64-image.de/
    [Export(typeof(IXrmToolBoxPlugin)),
        ExportMetadata("Name", "FieldGraphX"),
        ExportMetadata("Description", "Uncover all Cloud Flows connected to a given field and visualize the complete sequence of automations and triggers."),
        // Please specify the base64 content of a 32x32 pixels image
        ExportMetadata("SmallImageBase64", "iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAw3pUWHRSYXcgcHJvZmlsZSB0eXBlIGV4aWYAAHjabVBBDgMhCLzzij5BQRGf47bbpD/o8zsqu1nbTuIIDBkR2t+vJ906OCZKuZhW1QCkmio3BBYm2uAY0uABdgn5UqdTYJQEt8zU1PuPejwN5tUQ5YuR3V3YVqEm97cvI39Z+kQ9frhRdSPhKUQ3aPNbQauV6xe2PayweahTsnXsn7xge4+Md4R5lygBLGJzAOknkzQECmbBUGiqo1LAIupmWMi/PR2gD9v7WRprWGInAAABhWlDQ1BJQ0MgcHJvZmlsZQAAeJx9kT1Iw0AcxV9TtSIVFQuKOGSoTnZREXEqVSyChdJWaNXB5NIvaNKQpLg4Cq4FBz8Wqw4uzro6uAqC4AeIu+Ck6CIl/i8ptIj14Lgf7+497t4BQq3EVLMjDKiaZSSiETGdWRV9r+jCEPoxhwGJmXosuZhC2/F1Dw9f70I8q/25P0evkjUZ4BGJw0w3LOIN4plNS+e8TxxgBUkhPieeMOiCxI9cl11+45x3WOCZASOVmCcOEIv5FpZbmBUMlXiaOKioGuULaZcVzluc1VKFNe7JX+jPaitJrtMcRRRLiCEOETIqKKIECyFaNVJMJGg/0sY/4vjj5JLJVQQjxwLKUCE5fvA/+N2tmZuadJP8EaDzxbY/xgDfLlCv2vb3sW3XTwDvM3ClNf3lGjD7SXq1qQWPgL5t4OK6qcl7wOUOMPykS4bkSF6aQi4HvJ/RN2WAwVugZ83trbGP0wcgRV0t3wAHh8B4nrLX27y7u7W3f880+vsB7Ely16cRpm8AAA12aVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/Pgo8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA0LjQuMC1FeGl2MiI+CiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIKICAgIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiCiAgICB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iCiAgICB4bWxuczpHSU1QPSJodHRwOi8vd3d3LmdpbXAub3JnL3htcC8iCiAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyIKICAgIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIKICAgeG1wTU06RG9jdW1lbnRJRD0iZ2ltcDpkb2NpZDpnaW1wOjdmNjIwODUwLWNlYjctNGY5Ny05NjE1LWRiYTA3M2U4NjA3MyIKICAgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo0Zjc5NGZiOC01ZDA3LTQ0NGYtYjI4Mi0xODE0YjNjYTAxZjMiCiAgIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDozYzI0YTZkYi0wNzYxLTQ2YzktYWMyMS00NGQwMWM1YzAxOTMiCiAgIGRjOkZvcm1hdD0iaW1hZ2UvcG5nIgogICBHSU1QOkFQST0iMi4wIgogICBHSU1QOlBsYXRmb3JtPSJXaW5kb3dzIgogICBHSU1QOlRpbWVTdGFtcD0iMTc1MDY5ODQ1NzY3MTc4MiIKICAgR0lNUDpWZXJzaW9uPSIyLjEwLjM4IgogICB0aWZmOk9yaWVudGF0aW9uPSIxIgogICB4bXA6Q3JlYXRvclRvb2w9IkdJTVAgMi4xMCIKICAgeG1wOk1ldGFkYXRhRGF0ZT0iMjAyNTowNjoyM1QxOTowNzozNiswMjowMCIKICAgeG1wOk1vZGlmeURhdGU9IjIwMjU6MDY6MjNUMTk6MDc6MzYrMDI6MDAiPgogICA8eG1wTU06SGlzdG9yeT4KICAgIDxyZGY6U2VxPgogICAgIDxyZGY6bGkKICAgICAgc3RFdnQ6YWN0aW9uPSJzYXZlZCIKICAgICAgc3RFdnQ6Y2hhbmdlZD0iLyIKICAgICAgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDo5ZTU1MzY1NC0yNWZjLTRlOGMtYTg3My1hZTJhNDMzMGRjMDEiCiAgICAgIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkdpbXAgMi4xMCAoV2luZG93cykiCiAgICAgIHN0RXZ0OndoZW49IjIwMjUtMDYtMjNUMTk6MDc6MzciLz4KICAgIDwvcmRmOlNlcT4KICAgPC94bXBNTTpIaXN0b3J5PgogIDwvcmRmOkRlc2NyaXB0aW9uPgogPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgIAo8P3hwYWNrZXQgZW5kPSJ3Ij8+FBOcxAAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB+kGFxEHJaaw8asAAAM3SURBVEjH7ZbbbxNHFMbP7H3X693YSZw4XOJEGIRzaUBFAQriAYEQ7QP/Xx/LS/vUN6pKFJmqpAaHEHwJqomN0+A4Nr5lszu7Y68PD0GhhBSkUl6Qz9OM5sz8dOY7+mZIv9+HzxkcfOYYAAaATw9hf9Tv9xnrHuTznCSK/wMAAZIPnhi68s4iwkqu+N31C+OR4U8F9H1fFvm5RHzXdgBAlqWApiKA7bL10iYgjo+NAAAhBBDxH/sJgbdzAoAf1CC1nK3Vm7V64979NCISAOwjY93vb9+xLHs1W/jhx18ePs7fTT7ap6RX1qrbDQBotjpPM4UPaQAA7fYuz/OIsFVrbtcahJAzc3FdD8SORx3qVuutC+dmjh4Ze5BabbV3ltK5yMiQZTlG0F7J/EVdb3w0/BGAEdS+WfwKAJjnUeoB4EqmcOPqeY6QvYRnhbKmKpm1MnWZ63Uzay8iw2ZpYysY1BKnYpuV+sfalJCt6qtqreF1e7HJiXLl1c6us17aRCAAIMvi4tczE9FRI6hOTUZlSYxPTZjBQGQkVChWss9KsnRIv5E9u/Z9P5XOLcyfrNebCGgE9XDI/DWZjseijuPquqbIUihkEEIEnmesK8mSbVNJFAghPM+5HvN7vqJIoii+kYe8qfqdK9JUZfL4RKlcSS3nNUWWBe73pcytby+32hYAFEsvn+bXqctu3bzc831R4F2PqYpMXY/juEeP8zOJaY7jUum8qkgLc/Hh8NBBAAAw1v0jlYmOha9cOktdr9my9IDWalsIkFkr3bx2Mbn05M90ttvzQ6a+Xq5Ghk1KvY7lmLq6mn1uGjoitnbsvdMPsQrboWfm477vP1zO/fTzb1OT0UJxAwhBhMiIWXzx0rKcZtuaT0yXNqqA0LHsIVMXBI4XuIXZE5Vay/WY7biO4x6iwcXFeep6qeUcz3Hnz80+L/5d3qwtnj1t2ZTn+bHRUHljS5YlQ9ckWep0LNbtbdeaO7tO4mRMUSRNUxrNjh7QEFEQeE1V3gIQ8W4yfezI6IGCEJEQsl1vzyamw0PG+01CqQcEVEX+N6sg+4++5zHboYcmiaIQ1AP/zYvI4FcxAAwAXwDgNYnEmmPIGpWAAAAAAElFTkSuQmCC"),
        // Please specify the base64 content of a 80x80 pixels image
        ExportMetadata("BigImageBase64", "iVBORw0KGgoAAAANSUhEUgAAAFAAAABQCAIAAAABc2X6AAAAw3pUWHRSYXcgcHJvZmlsZSB0eXBlIGV4aWYAAHjabVBbDsMgDPvnFDsCJAHCcejWSbvBjj9D0qpss4TzMDIhYX+/nuE2QEmC5KqllRIBadKoI9Fo6JNTlMkT2SXUSz+cAqHFiGylFr9/9NNpYKEjyxcjvbuwrUIT99cvI7LAY6KRP9youRGTCckNun0rlqb1+oVtjyvUThgkuo79U1ds75HxDhPtnDiCmdUG4HFy4I6kgIkxFC612angxMXNsJB/ezoQPuRoWR4FiAIEAAABhWlDQ1BJQ0MgcHJvZmlsZQAAeJx9kT1Iw0AcxV9TtSIVFQuKOGSoTnZREXEqVSyChdJWaNXB5NIvaNKQpLg4Cq4FBz8Wqw4uzro6uAqC4AeIu+Ck6CIl/i8ptIj14Lgf7+497t4BQq3EVLMjDKiaZSSiETGdWRV9r+jCEPoxhwGJmXosuZhC2/F1Dw9f70I8q/25P0evkjUZ4BGJw0w3LOIN4plNS+e8TxxgBUkhPieeMOiCxI9cl11+45x3WOCZASOVmCcOEIv5FpZbmBUMlXiaOKioGuULaZcVzluc1VKFNe7JX+jPaitJrtMcRRRLiCEOETIqKKIECyFaNVJMJGg/0sY/4vjj5JLJVQQjxwLKUCE5fvA/+N2tmZuadJP8EaDzxbY/xgDfLlCv2vb3sW3XTwDvM3ClNf3lGjD7SXq1qQWPgL5t4OK6qcl7wOUOMPykS4bkSF6aQi4HvJ/RN2WAwVugZ83trbGP0wcgRV0t3wAHh8B4nrLX27y7u7W3f880+vsB7Ely16cRpm8AAA12aVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/Pgo8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA0LjQuMC1FeGl2MiI+CiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIKICAgIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiCiAgICB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iCiAgICB4bWxuczpHSU1QPSJodHRwOi8vd3d3LmdpbXAub3JnL3htcC8iCiAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyIKICAgIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIKICAgeG1wTU06RG9jdW1lbnRJRD0iZ2ltcDpkb2NpZDpnaW1wOjNiMWJjOTJlLTgxMTUtNDkzYS04NDgxLTlkZWIwOGU0OWVkZSIKICAgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpjYmUzMzkwZS05OTE3LTQ3OTQtOWZmZS02NDk0MTUzNzllZDEiCiAgIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1OTI1YjQ0YS0zZTMwLTRiNDQtYWIxMy0xMTE5NjM4OTFlNTUiCiAgIGRjOkZvcm1hdD0iaW1hZ2UvcG5nIgogICBHSU1QOkFQST0iMi4wIgogICBHSU1QOlBsYXRmb3JtPSJXaW5kb3dzIgogICBHSU1QOlRpbWVTdGFtcD0iMTc1MDY5ODQzNzY1NzI3OCIKICAgR0lNUDpWZXJzaW9uPSIyLjEwLjM4IgogICB0aWZmOk9yaWVudGF0aW9uPSIxIgogICB4bXA6Q3JlYXRvclRvb2w9IkdJTVAgMi4xMCIKICAgeG1wOk1ldGFkYXRhRGF0ZT0iMjAyNTowNjoyM1QxOTowNzoxNiswMjowMCIKICAgeG1wOk1vZGlmeURhdGU9IjIwMjU6MDY6MjNUMTk6MDc6MTYrMDI6MDAiPgogICA8eG1wTU06SGlzdG9yeT4KICAgIDxyZGY6U2VxPgogICAgIDxyZGY6bGkKICAgICAgc3RFdnQ6YWN0aW9uPSJzYXZlZCIKICAgICAgc3RFdnQ6Y2hhbmdlZD0iLyIKICAgICAgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDpjMDUxODM3MS02NzIzLTQyYWUtOTU3My03ZjQ1NmIwMzU5OGQiCiAgICAgIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkdpbXAgMi4xMCAoV2luZG93cykiCiAgICAgIHN0RXZ0OndoZW49IjIwMjUtMDYtMjNUMTk6MDc6MTciLz4KICAgIDwvcmRmOlNlcT4KICAgPC94bXBNTTpIaXN0b3J5PgogIDwvcmRmOkRlc2NyaXB0aW9uPgogPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgIAo8P3hwYWNrZXQgZW5kPSJ3Ij8+I6foCgAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB+kGFxEHEYcEBR4AAAqzSURBVHja7Zt7VFTVGsC/PS/mPcMwMDwFFaVERJEEVJCHGIJIg6FWXiMt86KlRpq51NLIV3av3lKvlS1KvXq1RFNAkUATFS0VFShBERCQ1wyvgRmYmbPvHweHwzAgKK11XZ391zn7dfZvf4/97Q8GEQQBf6XCgL9YoYFpYBqYBqaBaWAamAamgWlgGpgGpoFpYBqYBqaBaeBnrbD6aCu6V65p0fSsxwCol0q+gP/cCLdnEjj5v2eOnL7u62GHAHD/5lI3aXdfqUxbq4wInfCMATc2axbsyVKdWGstEfV/rrv3K0prD+zYn4kJPH2q37NkwzqtDozGAdECAAIY4WKTvGXRFwd+Ts3MfbaclkU7fUzBGADAXiH/duuiXQeyUs9efnZsmGK1N24XHU+7iHE3QxaJBPFzptnKrbuLuLMPybxg9dcIcGT4xL5XoNO1czhsBqPX8wIhZPb1rnrA/XUwjwFGneJt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"),
        ExportMetadata("BackgroundColor", "Lavender"),
        ExportMetadata("PrimaryFontColor", "Black"),
        ExportMetadata("SecondaryFontColor", "Gray")]
    public class FieldGraphX : PluginBase
    {
        public override IXrmToolBoxPluginControl GetControl()
        {
            return new FieldGraphXControl();
        }

        /// <summary>
        /// Constructor 
        /// </summary>
        public FieldGraphX()
        {
            // If you have external assemblies that you need to load, uncomment the following to 
            // hook into the event that will fire when an Assembly fails to resolve
            // AppDomain.CurrentDomain.AssemblyResolve += new ResolveEventHandler(AssemblyResolveEventHandler);
        }

        /// <summary>
        /// Event fired by CLR when an assembly reference fails to load
        /// Assumes that related assemblies will be loaded from a subfolder named the same as the Plugin
        /// For example, a folder named Sample.XrmToolBox.MyPlugin 
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="args"></param>
        /// <returns></returns>
        private Assembly AssemblyResolveEventHandler(object sender, ResolveEventArgs args)
        {
            Assembly loadAssembly = null;
            Assembly currAssembly = Assembly.GetExecutingAssembly();

            // base name of the assembly that failed to resolve
            var argName = args.Name.Substring(0, args.Name.IndexOf(","));

            // check to see if the failing assembly is one that we reference.
            List<AssemblyName> refAssemblies = currAssembly.GetReferencedAssemblies().ToList();
            var refAssembly = refAssemblies.Where(a => a.Name == argName).FirstOrDefault();

            // if the current unresolved assembly is referenced by our plugin, attempt to load
            if (refAssembly != null)
            {
                // load from the path to this plugin assembly, not host executable
                string dir = Path.GetDirectoryName(currAssembly.Location).ToLower();
                string folder = Path.GetFileNameWithoutExtension(currAssembly.Location);
                dir = Path.Combine(dir, folder);

                var assmbPath = Path.Combine(dir, $"{argName}.dll");

                if (File.Exists(assmbPath))
                {
                    loadAssembly = Assembly.LoadFrom(assmbPath);
                }
                else
                {
                    throw new FileNotFoundException($"Unable to locate dependency: {assmbPath}");
                }
            }

            return loadAssembly;
        }
    }
}